<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>AR 포토존</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="./js/webcomponents-loader.js"></script>
    <script src="./js/intersection-observer.js"></script>
    <script src="./js/ResizeObserver.js"></script>
    <script src="./js/fullscreen.polyfill.js"></script>
    <script src="./js/prismatic.min.js"></script>
    <script src="./js/focus-visible.js" defer></script>
    <script>
        function setScreenHeight() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        window.addEventListener('resize', setScreenHeight);
        setScreenHeight(); // 페이지 로드 시 즉시 실행
    </script>
      
  </head>
  <body>
    
    <div class="overlay-ui top-bar">
        <!--button id="map-btn" class="ui-button">🗺️ 행성 지도</button-->
        <button id="usage-btn" class="ui-button" onclick="(function() {
           const Dialog = document.querySelector('dialog'); 
           Dialog.classList.remove('hidden'); 
           Dialog.showModal();
         })()">📱 이용 안내</button>
    </div>

    <dialog id="usagemodal" class="hidden">
       <h2  class="AlertInfo">📱 조아용 AR 포토존 이용 안내</h2>
      <!--div class="center-wrapper"> 
         <div class="circle-image">
            <img src="./images/joayong-logo.png" alt="조아용 로고 이미지">
          </div>
       </div--> 
       <p Class="infoboxcom infobox1">AR 의정부는 의정부 건물과 함께 증강현실 사진을 찍을 수 있는 서비스입니다.</p>
       <p Class="infoboxcom infobox2">화면 하단의 AR 의정부 체험하기 버튼을 누른 뒤, 카메라로 바닥면을 비추면 3D 캐릭터가 나타납니다.</p>
       <p Class="infoboxcom infobox3">캐릭터를 한 손가락으로 터치하여 원하는 위치로 이동시킬 수 있습니다.</p>
       <p Class="infoboxcom infobox4">두 손가락을 사용하면 캐릭터를 회전하거나 크기를 확대/축소할 수 있습니다.</p>
       <p Class="infoboxcom infobox5">화면 중앙 하단의 원형 촬영 버튼을 눌러 사진 또는 짧은 영상을 촬영할 수 있습니다.</p>
       <p Class="infoboxcom infobox6">AR 의정부에서 특별한 추억을 남겨보세요.</p>
       <button onclick="usagemodal.close()" class="infoboxcom usageCloseBtn"> AR의정부 체험하기</button>
    </dialog>
    
    <!--section class="attribution">
      <span>
        <img
          src="./images/joayong-title-black1.png"
          alt="ocean breeze"
          class="center"
        />
      </span>
    </section-->

    <model-viewer
      style="background-color: #E8E8E8"
      interaction-prompt="auto"
      autoplay
      ar
      ar-modes="scene-viewer webxr"
      magic-leap
      quick-look-browsers="safari chrome"
      shadow-intensity="2"
      environment-image="neutral"
      ar-scale="0.25"
      camera-controls
      touch-action="pan-y"
      camera-target="0m -1.1m 0m"
      camera-orbit="-30deg auto auto"
      max-camera-orbit="auto 100deg auto"
    >
      <button aria-label="에이알로 보기" slot="ar-button" id="ar-button">AR 포토존 보기</button>

      <div id="ar-prompt">
        <img alt="에이알 손흔들기" src="./images/hand.png" />
      </div>
      <div class="progress-bar hide" slot="progress-bar">
        <div class="update-bar"></div>
      </div>
      <div class="slider">
        <div class="slides" id="modelselection">
          <button
            id="first_btn"
            style="
              background-image: url('./images/earth_planet.png');"
            aria-label="첫번째 모델"
            class="slide selected"
          ></button>
          <!--button
            id="second_btn"
            style="
              background-image: url('./images/earth-base.png');"
            aria-label="두번째 모델"
            class="slide"
          ></button-->

        </div>
      </div>
    </model-viewer>

    <script type="module">
      const modelViewer = document.querySelector("model-viewer");
      const modelSelectionBar = document.getElementById("modelselection");
      const FirstBtn = document.getElementById("first_btn");
  //    const SecondBtn = document.getElementById("second_btn");
      const mapBtn = document.getElementById('map-btn');
     
              // --- 1. 행성별로 연관된 모델 목록을 정의 ---
      const planetRelatedModels = {
            earth: [
                { id: 'earth_globe', name: '지구', thumbnail: './images/earth_planet.png', path: 'chinese-city', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/earth-base.png', path: 'earth-base', scale: '0.5 0.5 0.5' },
            ],
            mars: [
                { id: 'mars_globe', name: '화성', thumbnail: './images/mars-planet.png', path: 'mars-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/mars-base.png', path: 'mars-base', scale: '0.5 0.5 0.5' },
            ],
            jupiter: [
                { id: 'jupiter_globe', name: '목성', thumbnail: './images/jupiter-planet.png', path: 'jupiter-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/jupiter-base.png', path: 'jupiter-base', scale: '0.5 0.5 0.5' },
            ],
            saturn: [
                { id: 'saturn_globe', name: '토성', thumbnail: './images/saturn-planet.png', path: 'saturn-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/saturn-base.png', path: 'saturn-base', scale: '0.5 0.5 0.5' },
            ],
            uranus: [
                { id: 'uranus_globe', name: '천왕성', thumbnail: './images/uranus-planet.png', path: 'uranus-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/uranus-base.png', path: 'uranus-base', scale: '0.5 0.5 0.5' },
            ],
            neptune: [
                { id: 'neptune_globe', name: '해왕성', thumbnail: './images/neptune-planet.png', path: 'neptune-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: '우주정거장', thumbnail: './images/neptune-base.png', path: 'neptune-base', scale: '0.5 0.5 0.5' },
            ],
            // ... 다른 행성들의 모델 목록도 동일하게 정의 ...
        };
    document.addEventListener('DOMContentLoaded', () => {
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            // URL에서 'planet' 파라미터를 읽어오고, 없으면 'earth'를 기본값으로 사용
            const planetId = 'earth';
            const modelsToShow = planetRelatedModels[planetId];

//            if (!modelsToShow) {
//                alert("해당 행성의 모델 정보를 찾을 수 없습니다.");
//                return;
//            }
            
            initModelSelectionBar(modelsToShow);
        }

        function initModelSelectionBar(models) {
     //       modelSelectionBar.innerHTML = '';

            modelViewer.src = "./3D/" + models[0].path + ".glb";
            modelViewer.iosSrc = "./3D/" + models[0].path + ".usdz";
            
            const FirstPath = models[0].path;
            FirstBtn.style.backgroundImage = `url('${models[0].thumbnail}')`;
            FirstBtn.setAttribute("onClick", `switchSrc(this, '${FirstPath}')`);

     //       const SecondPath = models[1].path;
      //      SecondBtn.style.backgroundImage = `url('${models[1].thumbnail}')`;
      //      SecondBtn.setAttribute("onClick", `switchSrc(this, '${SecondPath}')`);
        }   

        window.switchSrc = (element, name) => {
        const base = "./models/" + name;
        const ImgBase = "./images/" + name;
        modelViewer.src = base + ".glb";
        modelViewer.iosSrc = base + ".usdz";
        modelViewer.poster = ImgBase + ".png";
        const slides = document.querySelectorAll(".slide");
        slides.forEach((element) => {
          element.classList.remove("selected");
        });
        element.classList.add("selected");
      };

      document
        .querySelector(".slider")
        .addEventListener("beforexrselect", (ev) => {
          // Keep slider interactions from affecting the XR scene.
          ev.preventDefault();
        });

   //     mapBtn.onclick = () => window.location.href = './joayong-map.html';
    
        init();
    });

    

    </script>
    <script
      type="module"
      src="./js/model-viewer.min.js"
    ></script>

    <link rel="stylesheet" href="./css/joayong-photo.css" />

  </body>
</html>